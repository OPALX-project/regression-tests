//-----------------
// Cornell DC gun injector test
//
//-----------------
TITLE, STRING="DCGun-Cornell";


OPTION, ECHO=TRUE; //ECHO Controls printing of an echo of input lines on the standard error file.
OPTION, INFO=TRUE; //INFO If this option is turned off, OPAL suppresses all information messages.
OPTION, PSDUMPFREQ=10000; //Defines after how many time steps the phase space is dumped into the H5Part file. Default value is 10.
OPTION, AUTOPHASE = 1;
Option, VERSION=10900;


REAL QB               = 100e-12;
REAL BFREQ            = 1.3e9;
REAL BCURRENT         = QB*BFREQ;

call, file = "lat.opal";

file_distribution:DISTRIBUTION, TYPE=fromfile, FNAME="lat.opal_particles";


no_fieldsolver:FIELDSOLVER,
	FSTYPE = NONE, MX = 16, MY = 16, MT = 32,
	PARFFTX = true, PARFFTY = true, PARFFTT = true,
	BCFFTX = open, BCFFTY = open, BCFFTT = open,
	BBOXINCR = 1, GREENSF = INTEGRATED;

my_beam: BEAM,
	PARTICLE=ELECTRON,
	//pc = 10,          // momentum per particle in GeV/c
	NPART = 27,     //number of test particles simulated
	BCURRENT = BCURRENT, // beam current in A
	BFREQ = BFREQ;

SELECT, LINE=lattice;

// Simulation
TRACK, 	LINE = lattice,
	BEAM = my_beam,
	MAXSTEPS = 100000,
	DT=1.0e-12, //Timestep size in s
        T0=5.0e-11,
	ZSTOP=12.0; //Stopping position z in meters
RUN,	METHOD = "PARALLEL-T",
	BEAM = my_beam,
	FIELDSOLVER = no_fieldsolver,
	DISTRIBUTION = file_distribution;
ENDTRACK;

STOP;