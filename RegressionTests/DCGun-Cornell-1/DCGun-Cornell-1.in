//-----------------
// Cornell DC gun injector test
//
//-----------------
TITLE, STRING="DCGun-Cornell";


OPTION, ECHO=TRUE; //ECHO Controls printing of an echo of input lines on the standard error file.
OPTION, TFS =FALSE; //TFS If true, the format is in TFS format, otherwise in human-readable format.
OPTION, INFO=TRUE; //INFO If this option is turned off, OPAL suppresses all information messages.
OPTION, PSDUMPFREQ=100; //Defines after how many time steps the phase space is dumped into the H5Part file. Default value is 10.
OPTION, AUTOPHASE = 1;


QB               = 100e-12;
BFREQ            = 1.3e9;
BCURRENT         = QB*BFREQ;

call, file = "lat.opal";

file_distribution:DISTRIBUTION, DISTRIBUTION=fromfile, FNAME="lat.opal_particles";

no_fieldsolver:FIELDSOLVER,
	FSTYPE = NONE, MX = 16, MY = 16, MT = 32,
	PARFFTX = true, PARFFTY = true, PARFFTT = true,
	BCFFTX = open, BCFFTY = open, BCFFTT = open,
	BBOXINCR = 1, GREENSF = INTEGRATED;

my_beam: BEAM,
	PARTICLE=ELECTRON, 
	//pc = 10,          // momentum per particle in GeV/c
	NPART = 20,     //number of test particles simulated
	BCURRENT = BCURRENT, // beam current in A
	BFREQ = BFREQ;

SELECT, LINE=lattice;

// Simulation
TRACK, 	LINE = lattice, 
	BEAM = my_beam, 
	MAXSTEPS = 100000,
	DT=1.0e-12, //Timestep size in s
	ZSTOP=12.0; //Stopping position z in meters
RUN,	METHOD = "PARALLEL-T",  
	BEAM = my_beam, 
	FIELDSOLVER = no_fieldsolver, 
	DISTRIBUTION = file_distribution;
ENDTRACK;

STOP;
